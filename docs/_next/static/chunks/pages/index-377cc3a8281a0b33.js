(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(9262)}])},9262:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return m}});var s=l(5893),a=l(5675),r=l.n(a),n=l(7294),i=l(4089),o=l(1163),d=l(1752),c=l.n(d);let{publicRuntimeConfig:h}=c()(),u="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",x="https://github.com/chesslink/chesslink.github.io/issues";function m(){let e=(0,o.useRouter)(),t=e.query.state?e.query.state:"~",{history:l,error:a}=(0,n.useMemo)(()=>{if("~"!==t.charAt(t.length-1)||t.length%2==0)return{error:"truncated",history:[]};let e=[];for(let l=0;l<t.length-1;l+=2){let s=f.indexOf(t[l+0]),a=f.indexOf(t[l+1]);e.push([s,a])}return{history:e}},[t]),[r,d]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1),[y,P]=(0,n.useState)(!1),[M,q]=(0,n.useState)(null),[A,S]=(0,n.useState)(null),E=(0,n.useMemo)(()=>v(u).board,[u]),[K,O]=(0,n.useState)(null),B=(0,n.useMemo)(()=>{let e={board:[...E],lostPieces:[],castling:{K:!0,Q:!0,k:!0,q:!0},enPassant:null},t=l.concat(K?[K]:[]);for(let s of t)C(e,s);let a=t.length%2!=0;return e.check=_(e,a),e.mate=function(e,t,l){if(void 0===l&&(l=_(e,t)),!l)return!1;let s=t?8:0,a=e.board.map((e,t)=>t).filter(t=>0!==e.board[t]&&(8&e.board[t])===s).map(t=>k(e,t).possibleMoves.length).every(e=>0===e);return a}(e,a,e.check),e},[u,l,K]),Q=l.length%2!=0,R=(0,n.useMemo)(()=>{if(null===K)return null;let e=l.concat([K||[]]).flat().map(e=>f[e]).join("");return"".concat(window.location.origin,"/?state=").concat(e).concat("~")},[l,K]),T=(0,n.useRef)(null),{possibleMoves:F,forbiddenMoves:H}=(0,n.useMemo)(()=>k(B,M),[B,M]);return(0,s.jsxs)("div",{className:"w-full min-h-full flex flex-col items-center justify-between gap-4 md:py-4 max-w-xl mx-auto",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"flex flex-col gap-0 items-center",children:[(0,s.jsxs)("h1",{className:"text-3xl font-black text-black dark:text-slate-300",children:["chess",(0,s.jsx)("span",{className:"text-board-dark dark:text-slate-500",children:"link"})]}),(0,s.jsx)("span",{className:"text-xs font-bold text-slate-500",children:"chesslink.github.io"})]}),(0,s.jsxs)("div",{className:"flex flex-col w-full md:w-auto gap-1 md:gap-0",children:[B.lostPieces&&(0,s.jsx)(b,{outerClassName:"md:px-8 w-full",aspect:"6.25%",innerClassName:"flex flex-row",children:B.lostPieces.filter(e=>Q?e<8:e>=8).map((e,t)=>(0,s.jsx)(w,{className:"",piece:e},t))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-col gap-0",children:[(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-board-darker font-bold",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"w-16 text-center rotate-180",children:"ABCDEFGH"[Q?7-t:t]},t))}),(0,s.jsxs)("div",{className:"md:w-auto w-full flex flex-row gap-0",children:[(0,s.jsx)("div",{className:"md:flex hidden flex-col h-full justify-center items-center w-6 text-board-darker font-bold py-2",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"h-16 flex items-center",children:Q?1+t:8-t},t))}),(0,s.jsx)("div",{className:"w-full md:w-auto border-board-dark md:border-8 border-double border-y-8 box-content",children:(0,s.jsx)(b,{outerClassName:"md:w-128 w-full",aspect:"100%",children:(0,s.jsx)("div",{className:"flex flex-row md:h-auto md:w-auto h-full w-full",children:(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)("div",{className:"flex flex-col md:h-auto h-full",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"md:h-16 h-1/8 flex flex-row",children:Array(8).fill(0).map((e,l)=>[t^(Q?7:0),l^(Q?7:0),8*t+l^(Q?63:0)]).map(e=>{let[t,a,r]=e;return(0,s.jsxs)("button",{disabled:!(null===M&&null===K&&0!==B.board[r]&&(Q?B.board[r]>=8:B.board[r]<8)||null!==M&&null===K&&F.includes(r)||null!==M&&0!==B.board[r]&&(Q?B.board[r]>=8:B.board[r]<8)||null===M&&null!==K&&r===K[0]),className:(0,i.twCascade)("h-full md:w-16 w-1/8 relative",{"bg-board-light dark:bg-slate-300":(t+a&1)==0,"bg-board-dark dark:bg-slate-400":(t+a&1)==1}),onClick(e){if(null===K){j(!0);let t=B.board[r];M===r?q(null):0!=t&&(t>=8&&Q||t<8&&!Q)?q(r):null!==M&&F.includes(r)&&(O([M,r]),q(null))}else r===K[0]&&(O(null),q(r),P(!0))},onMouseOver:()=>void S(r),onMouseOut:()=>void S(null),children:[0!==B.board[r]&&(0,s.jsx)(p,{className:"h-full w-full",piece:B.board[r]}),F.includes(r)&&(0,s.jsx)("div",{className:"absolute h-[87.5%] w-[87.5%] border-dotted border-4 border-slate-500 dark:border-slate-800 rounded-full -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),H.includes(r)&&(0,s.jsxs)("div",{className:"absolute inset-0",title:"This move would leave your king in check.",children:[(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-dotted border-slate-500 dark:border-slate-800 border-t-4 -rotate-45"}),(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-dotted border-slate-500 dark:border-slate-800 border-t-4 rotate-45"})]}),(M===r||!g&&null===M&&null===K&&l.length>0&&l[l.length-1].includes(r)||(null==K?void 0:K.includes(r)))&&(0,s.jsx)("div",{className:"absolute pointer-events-none inset-0 border-solid md:border-4 border-[3px] border-slate-600 dark:border-slate-800"})]},a)})},t))}),B.check&&(0,s.jsx)("svg",{viewBox:"0 0 400 100",xmlns:"http://www.w3.org/2000/svg",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:h-32 h-28 pointer-events-none",children:(0,s.jsx)("text",{className:(0,i.twCascade)("text-4xl stroke-black fill-white font-black font-serif",{"fill-black stroke-white":l.length%2==(null===K?0:1)}),x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"central",strokeWidth:"3",paintOrder:"stroke",children:B.mate?"CHECKMATE":"CHECK"})}),a&&(0,s.jsxs)(N,{children:[(0,s.jsx)("h2",{className:"text-lg self-center",children:"Link error"}),(0,s.jsxs)("p",{children:["It looks like the game link is truncated. Please verify the link and try again. If that doesn't work, please"," ",(0,s.jsx)("a",{className:"underline",href:x,children:"report an issue"}),"."]})]}),!a&&0===l.length&&!r&&(0,s.jsxs)(N,{onClose:()=>void d(!0),children:[(0,s.jsxs)("p",{children:["Welcome to ",(0,s.jsx)("i",{children:"chesslink"}),", a web app for playing correspondance chess."]}),(0,s.jsx)("p",{children:"When you've made your first move, a link is generated. You send this link to your opponent who continues the game."}),(0,s.jsx)("p",{children:"The state of the game is not stored on this server, it is encoded in the links you send when playing."}),(0,s.jsx)("div",{className:"self-center",children:(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void d(!0),children:"Start"})})]}),R&&c&&(0,s.jsxs)(N,{className:"items-center",onClose:()=>void m(!1),children:[B.check&&(0,s.jsx)("h1",{className:"text-lg font-bold",children:B.mate?"Checkmate!":"Check!"}),(0,s.jsx)("p",{className:"text-center",children:"Send the following link to your opponent"}),(0,s.jsx)("div",{className:"flex flex-row gap-4",children:(0,s.jsx)("input",{ref:T,style:{all:"revert"},type:"text",value:R,readOnly:!0,onFocus:e=>void e.target.select()})}),navigator&&(0,s.jsxs)("div",{className:"flex flex-row gap-4",children:[navigator.clipboard&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.clipboard.writeText(R),children:"Copy to clipboard"}),navigator.share&&(0,s.jsx)("button",{style:{all:"revert"},onClick:()=>void navigator.share({title:"Chesslink",url:R}).then(()=>{}).catch(e=>void console.error(e)),children:"Share"})]})]})]})})})}),(0,s.jsx)("div",{className:"hidden md:flex flex-col h-full justify-center items-center w-6 text-board-darker font-bold py-2",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"h-16 flex items-center rotate-180",children:Q?1+t:8-t},t))})]}),(0,s.jsx)("div",{className:"hidden md:flex flex-row w-full justify-center text-board-darker font-bold",children:Array(8).fill(0).map((e,t)=>(0,s.jsx)("div",{className:"w-16 text-center",children:"ABCDEFGH"[Q?7-t:t]},t))})]}),B.lostPieces&&(0,s.jsx)(b,{outerClassName:"md:px-8 w-full",aspect:"6.25%",innerClassName:"flex flex-row",children:B.lostPieces.filter(e=>Q?e>=8:e<8).map((e,t)=>(0,s.jsx)(w,{className:"",piece:e},t))}),(0,s.jsx)("div",{className:(0,i.twCascade)("w-full flex flex-row justify-center pt-2 gap-2 items-center"),children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:(0,i.twCascade)("absolute -top-3 -translate-x-1/2 left-1/2 pointer-events-none rounded-full w-3 h-3 bg-board-dark animate-bounce transition-opacity duration-300",{"opacity-0":!R||y||l.length>=4})}),(0,s.jsx)("button",{style:{all:"revert"},onClick(){m(!0),P(!0)},disabled:null===R||c,children:"Submit move"})]})})]}),(0,s.jsxs)("div",{className:"flex flex-row w-full justify-between text-xs text-slate-500 max-w-[528px] md:px-0 px-1",children:[(0,s.jsxs)("p",{children:["Version ",null==h?void 0:h.version]}),(0,s.jsx)("a",{className:"hover:underline",href:"https://github.com/chesslink/chesslink.github.io/#readme",children:"About"}),(0,s.jsx)("a",{className:"hover:underline",href:x,children:"Report an issue"})]})]})}function b(e){let{children:t,innerClassName:l,outerClassName:a,aspect:r}=e;return(0,s.jsx)("div",{className:(0,i.twCascade)("",a),children:(0,s.jsx)("div",{className:"h-0 relative w-full",style:{paddingBottom:r},children:(0,s.jsx)("div",{className:(0,i.twCascade)("absolute inset-0",l),children:t})})})}function p(e){let{className:t,piece:l}=e;return y.has(15&l)?(0,s.jsx)("div",{className:(0,i.twCascade)("relative w-full h-full",t),title:g.get(l),children:(0,s.jsx)(r(),{src:y.get(15&l),alt:g.get(l)||"",className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full"})}):(0,s.jsx)(s.Fragment,{})}function w(e){let{className:t,piece:l}=e;return(0,s.jsx)(b,{outerClassName:"w-1/16",aspect:"100%",children:(0,s.jsx)(r(),{src:y.get(15&l),alt:g.get(l)||"",className:"h-full",title:g.get(l)||""})})}let v=e=>{let t=new Map([["p",9],["n",10],["b",11],["r",12],["q",13],["k",14],["P",1],["N",2],["B",3],["R",4],["Q",5],["K",6]]),l=[];for(let s of e)l.length<64&&(t.has(s)?l.push(t.get(s)):/^[0-9]$/.test(s)&&l.push(...Array(parseInt(s)).fill(0)));return{board:l}},g=new Map([[0,""],[1,"white pawn"],[2,"white knight"],[3,"white bishop"],[4,"white rook"],[5,"white queen"],[6,"white king"],[9,"black pawn"],[10,"black knight"],[11,"black bishop"],[12,"black rook"],[13,"black queen"],[14,"black king"]]);function k(e,t){let{board:l}=e;if(null===t||0===l[t])return{forbiddenMoves:[],possibleMoves:[]};let s=j(e,t),a=l[t]>=8,r=l.map((e,t)=>[e,t]).filter(e=>{let[t,l]=e;return t&&(a?t<8:t>=8)}),n=[];for(let i of s){let o={board:[...l],castling:{...e.castling},enPassant:e.enPassant};C(o,[t,i]);let d=o.board.indexOf((a?8:0)+6);for(let[c,h]of r){let u=j(o,h);u.includes(d)&&n.push(i)}}return{forbiddenMoves:n,possibleMoves:s.filter(e=>!n.includes(e))}}function j(e,t){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(null===t)return[];let{board:s,castling:a,enPassant:r}=e,n=[],[i,o]=[Math.floor(t/8),t%8],d=s[t],c=d>=8,h=c?1:-1;switch(7&d){case 1:0===s[(i+h)*8+o]&&(n.push([i+h,o]),(d<8&&6===i||d>=8&&1===i)&&0===s[(i+2*h)*8+o]&&n.push([i+2*h,o])),(s[(i+h)*8+o-1]||r===(i+h)*8+o-1&&(s[t]^s[8*i+o-1])==8)&&n.push([i+h,o-1]),(s[(i+h)*8+o+1]||r===(i+h)*8+o+1&&(s[t]^s[8*i+o+1])==8)&&n.push([i+h,o+1]);break;case 2:n.push(...[[-2,-1],[-2,1],[2,-1],[2,1],[-1,-2],[-1,2],[1,-2],[1,2]].map(e=>{let[t,l]=e;return[i+t,o+l]}));break;case 3:for(let[u,f]of[[-1,-1],[1,1],[1,-1],[-1,1]])for(let[x,m]=[i+u,o+f];x>=0&&x<8&&m>=0&&m<8&&(n.push([x,m]),!s[8*x+m]);x+=u,m+=f);break;case 4:for(let[b,p]of[[-1,0],[1,0],[0,-1],[0,1]])for(let[w,v]=[i+b,o+p];w>=0&&w<8&&v>=0&&v<8&&(n.push([w,v]),!s[8*w+v]);w+=b,v+=p);break;case 5:for(let[g,k]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,1],[1,-1],[-1,1]])for(let[j,N]=[i+g,o+k];j>=0&&j<8&&N>=0&&N<8&&(n.push([j,N]),!s[8*j+N]);j+=g,N+=k);break;case 6:if(n.push(...[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(e=>{let[t,l]=e;return[i+t,o+l]})),l&&!_(e,c)){if((c&&!0===a.k||!c&&!0===a.K)&&0===s[t+1]&&0===s[t+2]){let y=P(e);C(y,[t,t+1]),_(y,c)||n.push([i,o+2])}if((c&&!0===a.q||!c&&!0===a.Q)&&0===s[t-1]&&0===s[t-2]&&0===s[t-3]){let M=P(e);C(M,[t,t-1]),_(M,c)||n.push([i,o-2])}}}return n.filter(e=>{let[t,l]=e;return t>=0&&t<8&&l>=0&&l<8&&(0===s[8*t+l]||d<8&&s[8*t+l]>=8||d>=8&&s[8*t+l]<8)}).map(e=>{let[t,l]=e;return 8*t+l})}function N(e){let{children:t,className:l,onClose:a,...r}=e;return(0,s.jsx)("div",{className:(0,i.twCascade)("absolute inset-0 bg-black bg-opacity-50","flex flex-col items-center justify-center"),children:(0,s.jsxs)("div",{className:(0,i.twCascade)("relative rounded-md bg-slate-100 text-black w-10/12 p-6","flex flex-col gap-4 items-start",l),children:[t,a&&(0,s.jsxs)("button",{className:"absolute top-2 right-2 h-3 w-3",onClick:a,title:"Close",children:[(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-black border-t-2 -rotate-45"}),(0,s.jsx)("div",{className:"absolute top-1/2 w-full h-0 border-black border-t-2 rotate-45"})]})]})})}let y=new Map([[6,{src:"/_next/static/media/Chess_klt45.d44afabb.svg",height:45,width:45}],[5,{src:"/_next/static/media/Chess_qlt45.9302ef5e.svg",height:45,width:45}],[3,{src:"/_next/static/media/Chess_blt45.b5239580.svg",height:45,width:45}],[2,{src:"/_next/static/media/Chess_nlt45.4b8a5a97.svg",height:45,width:45}],[4,{src:"/_next/static/media/Chess_rlt45.0f643735.svg",height:45,width:45}],[1,{src:"/_next/static/media/Chess_plt45.c737daaf.svg",height:45,width:45}],[14,{src:"/_next/static/media/Chess_kdt45.450ddba8.svg",height:45,width:45}],[13,{src:"/_next/static/media/Chess_qdt45.07b03f89.svg",height:45,width:45}],[11,{src:"/_next/static/media/Chess_bdt45.31a33096.svg",height:45,width:45}],[10,{src:"/_next/static/media/Chess_ndt45.5c2f8fb5.svg",height:45,width:45}],[12,{src:"/_next/static/media/Chess_rdt45.803056f9.svg",height:45,width:45}],[9,{src:"/_next/static/media/Chess_pdt45.26191735.svg",height:45,width:45}]]);function C(e,t){let{board:l,lostPieces:s,castling:a,enPassant:r}=e;if(null!==t){let[n,i]=t;if((7&l[n])==6&&(7&n)==4&&((7&i)==2?(l[(56&i)+3]=l[(56&i)+0],l[(56&i)+0]=0):(7&i)==6&&(l[(56&i)+5]=l[(56&i)+7],l[(56&i)+7]=0)),l[i])void 0!==s&&s.push(l[i]);else if(i===r&&(7&l[n])==1){let o=(7&i)-(7&n);void 0!==s&&s.push(l[n+o]),l[n+o]=0}l[i]=l[n],l[n]=0,r=null,(7&l[i])==1&&(16===Math.abs(i-n)&&(r=(n+i)/2),i<8?l[i]=5:i>=56&&(l[i]=13)),0===n?a.q=!1:4===n?(a.q=!1,a.k=!1):7===n?a.k=!1:56===n?a.Q=!1:60===n?(a.Q=!1,a.K=!1):63===n&&(a.K=!1),e.castling=a,e.enPassant=r}}function _(e,t){let l=t?8:0,s=e.board.map((e,t)=>t).filter(t=>0!==e.board[t]&&(8&e.board[t])!==l),a=s.map(t=>j(e,t,!1).map(t=>e.board[t]).includes((8&l)+6)).some(e=>e);return a}function P(e){return{...e,board:[...e.board],castling:{...e.castling},lostPieces:e.lostPieces?[...e.lostPieces]:void 0}}}},function(e){e.O(0,[626,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);